C51 COMPILER V9.00   LCD12864                                                              05/31/2013 22:02:17 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN .\output\LCD12864.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE src\LCD12864.c BROWSE DEBUG OBJECTEXTEND PRINT(.\output\LCD12864.lst) OBJEC
                    -T(.\output\LCD12864.obj)

line level    source

   1          /*********************************************************** 
   2          文件名称： LCD12864驱动程序
   3          作 者：    梁权威
   4          版 本：    0.01
   5          说 明：    
   6          时间 ：    2012年12月12日20:24:24
   7          修改记录：
   8          总结 ：         
   9          ***********************************************************/
  10          #include"LCD12864.h"
  11          #include"delay.h"
  12          #include<intrins.h>
  13          
  14          /*------------------------------------------
  15                  LCD12864液晶控制管脚定义
  16          -------------------------------------------*/
  17          sbit RS = P2^0;  //模式位，为0 输入指令，为1输入数据
  18          sbit RW = P2^1;  //读写位，为0读，1为写
  19          sbit EN = P2^2;  //使能端
  20          sbit PSB = P2^7; //高电平为数据并行传输，低电平为串行传输
  21          sbit Busy = P0^7; //液晶忙标志
  22          
  23          /*------------------------------------------
  24                  定义数据端口
  25          -------------------------------------------*/
  26          #define DataPort P0      //数据总线
  27          
  28          /*********************************************************** 
  29          函数名称：       void Check_Busy()
  30          函数功能：       液晶等待                  
  31          入口参数：       无 
  32          出口参数：        
  33          备 注： 
  34          ***********************************************************/
  35          void Check_Busy()  //检查忙碌（底层函数）
  36          {
  37   1              do
  38   1              {
  39   2                      RS = 0;   //检测液晶忙是读取液晶状态
  40   2                      RW = 1;
  41   2                      EN = 0;
  42   2                      _nop_();
  43   2                      EN = 1;
  44   2              }while( Busy == 1 ); //如果P0^7等于1，表示液晶在进行内部操作，不接受外部指令
  45   1              EN = 0; //释放使能      
  46   1      }
  47          
  48          /*********************************************************** 
  49          函数名称：       void Write_Com( u8 com )
  50          函数功能：       写液晶指令                
  51          入口参数：       com 
  52          出口参数：        
  53          备 注： 
  54          ***********************************************************/
C51 COMPILER V9.00   LCD12864                                                              05/31/2013 22:02:17 PAGE 2   

  55          void Write_Com( u8 com ) //写命令到LCD12864( 底层函数 )
  56          {
  57   1              Check_Busy();//检测液晶忙碌
  58   1              RS = 0;
  59   1              RW = 0;
  60   1              DataPort = com;
  61   1              EN = 1;
  62   1              _nop_();
  63   1              _nop_();
  64   1              _nop_();
  65   1              EN = 0;
  66   1      }
  67          
  68          /*********************************************************** 
  69          函数名称：       void Write_Data( u8 dat )
  70          函数功能：       写数据到液晶指   
  71          入口参数：       dat 
  72          出口参数：        
  73          备 注： 
  74          ***********************************************************/
  75          void Write_Data( u8 dat ) //写数据到LCD12864( 底层函数 )
  76          {
  77   1              Check_Busy();//检测液晶忙碌
  78   1              RS = 1;
  79   1              RW = 0;
  80   1              DataPort = dat;  //准备好数据
  81   1              EN = 1;                  //使能从高电平变成低电平，数据就被送到液晶里面
  82   1              _nop_();
  83   1              _nop_();
  84   1              _nop_();
  85   1              EN = 0; 
  86   1      }
  87          
  88          /*********************************************************** 
  89          函数名称：       void Init_LCD12864()
  90          函数功能：       液晶初始化  
  91          入口参数：       无 
  92          出口参数：        
  93          备 注： 
  94          ***********************************************************/
  95          void Init_LCD12864() //被调用层函数
  96          {
  97   1              DelayMs( 40 ); //进来延迟40ms
  98   1              PSB = 1;          //设置为并行工作模式
  99   1              DelayMs( 1);
 100   1              Write_Com( 0x30 ); //设置基本指令
 101   1              DelayMs( 50 );
 102   1              Write_Com( 0x30 ); //设置8bit数据传送
 103   1              DelayMs( 50 );     // 延迟时间大于37US
 104   1              Write_Com( 0x0c ); //开显示
 105   1              DelayMs( 50 ); //要大于100us
 106   1              Write_Com( 0x01 ); //清屏
 107   1              DelayMs( 20 ); //要大于10us
 108   1              Write_Com( 0x06 );////指定在资料的读取及写入时，设定游标的移动方向及指定显示的移位，光标从右向左加1位移动
 109   1              DelayMs( 50 );  
 110   1      }
 111          
 112          /*********************************************************** 
 113          函数名称：       void  DisplayCGRAM( u8 x, u8 y )
 114          函数功能：       显示用户自定义字符，指定的位置显示
 115          入口参数：       x表示是从第几个字符开始显示，y表示是纵坐标 
 116          出口参数：        
C51 COMPILER V9.00   LCD12864                                                              05/31/2013 22:02:17 PAGE 3   

 117          备 注： 
 118          ***********************************************************/
 119          void  DisplayCGRAM( u8 x, u8 y )  //被调用层函数
 120          {
 121   1              u8 address;
 122   1              switch( y )       //y表示是纵坐标
 123   1              {
 124   2                      case 1: address = 0x80 + x; break;
 125   2                      case 2: address = 0x90 + x; break;
 126   2                      case 3: address = 0x88 + x; break;
 127   2                      case 4: address = 0x98 + x; break;
 128   2                      default: break;
 129   2              }
 130   1              Write_Com( address );
 131   1      }
 132          
 133          /*********************************************************** 
 134          函数名称：       void LCD_PutString(u8 x, u8 y, u8 8s )
 135          函数功能：       显示用户自定义字符串，指定的位置显示
 136          入口参数：       x表示是从第几个字符开始显示，y表示是纵坐标 
 137          出口参数：        
 138          备 注： 
 139          ***********************************************************/
 140          void LCD_PutString( u8 x, u8 y, u8 *s )  //如果写成DisplayGCRAMStr()函数有还有错误 
 141          {
 142   1              DisplayCGRAM(  x, y ); //地址转换
 143   1      
 144   1              while( *s != '\0' )     
 145   1              {
 146   2                      Write_Data( *s );  //应用：LCD_PutString( 0, 1, "嘻嘻" );直接显示：嘻嘻
 147   2                      s++;
 148   2                      DelayUs( 50 ); //这里的延迟起到所显示内容一个一个显示（时间长，显示慢）
 149   2              }
 150   1      } 
 151          
 152          
 153          
 154          
 155          
 156          
 157          
 158          
 159          
 160          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    212    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
