C51 COMPILER V9.00   DS18B20DISTEMP                                                        05/31/2013 22:02:19 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE DS18B20DISTEMP
OBJECT MODULE PLACED IN .\output\ds18b20distemp.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE src\ds18b20distemp.c BROWSE DEBUG OBJECTEXTEND PRINT(.\output\ds18b20distem
                    -p.lst) OBJECT(.\output\ds18b20distemp.obj)

line level    source

   1          /*********************************************************** 
   2          ÎÄ¼şÃû³Æ£º DS18b20ÏÔÊ¾º¯Êı
   3          ×÷ Õß£º    ÁºÈ¨Íş
   4          °æ ±¾£º    0.01
   5          Ëµ Ã÷£º    
   6          Ê±¼ä £º    2012Äê12ÔÂ19ÈÕ20:50:58
   7          ĞŞ¸Ä¼ÇÂ¼£º
   8          ×Ü½á £º   1£ºÒ»¶¨Òª½Ó4.7KµÄÉÏÀ­µç×è     
   9          ***********************************************************/
  10          #include"ds18b20distemp.h"
  11          #include"ds18b20.h"
  12          #include"LCD12864.h"
  13          #include"delay.h"
  14          #include"ds18b20alarm.h"
  15          /*------------------------------------------
  16                  ¶¨Òå²Ù×÷±äÁ¿
  17          -------------------------------------------*/
  18          u8  idata Display_Digit[] = {0,0,0,0};//´ıÏÔÊ¾µÄ¸÷ÎÂ¶ÈÊıÎ»      (Æ¬ÄÚRAM¼ä½ÓÑ°Ö·Çø00H-ffH)                                                
  19          u8  idata Current_Temp_DIS_BUFFER[]= {"temp:       ¡æ  "};  //·ûºÅÕ¼ÓĞÒ»×Ö½Ú£¬Ë«Î»£¨0x80 ÔÙ¾Í0x82ÄÇÀïÏÔÊ¾£
             -¬Èç¹ûÊÇ0x81ÔòÏÔÊ¾ÂÒÂë£©²ÅĞĞ
  20          u8  code df_Table[] = {0,1,1,2,3,3,4,4,5,6,6,7,8,8,9,9};//¶¨ÒåĞ¡ÊıÎ»¶ÔÕÕ±í
  21          u8  idata Current = 0;
  22          /*********************************************************** 
  23          º¯ÊıÃû³Æ£º       void ds18b20_Display_Temperature())
  24          º¯Êı¹¦ÄÜ£º       ÔÚÒº¾§ÏÔÊ¾ds18b20ÎÂ¶È             
  25          Èë¿Ú²ÎÊı£º       
  26          ³ö¿Ú²ÎÊı£º      
  27          ±¸ ×¢£º 
  28          ***********************************************************/
  29          void ds18b20_Display_Temperature()
  30          {
  31   1              u8 i = 150;     
  32   1              S8      Signed_Current_Temp; //¶¨ÒåÒ»¸öµ±Ç°ÎÂ¶È±äÁ¿À´ÅĞ¶Ï±¨¾¯ÎÂ¶ÈÊÇÎªÕıÖµ»¹ÊÇ¸ºÖµ£¬ËùÒÔÒª¶¨ÒåÎªÎŞ·ûºÅÀàĞÍ
  33   1              u8 ng = 0;
  34   1              DelayUs( 10 );
  35   1      
  36   1              if( (Temp_Value[ 1 ] & 0xf8) == 0xf8 )//ÅĞ¶ÏÊÇ·ñÎª¸ºÊı¸ßÎ»:¸ßÎ»×Ö½ÚÇ°ÎåÎ»Èç¹ûÈ«²¿Îª1ËµÃ÷¶ÁÈ¡µÄÎÂ¶ÈÊÇ¸ºÖµ·
             -ñÔòÊÇÕıÖµ(1111 1XXX XXXX XXXX(0XF8) )
  37   1              {
  38   2                      Temp_Value[ 1 ] = ~Temp_Value[ 1 ]; //¸ßÎ»È¡·´
  39   2                      Temp_Value[ 0 ] = ~Temp_Value[ 0 ] + 1; //µÍÎ»Ò²È¡·´¼Ó1
  40   2                      if( Temp_Value[ 0 ] == 0x00 )//¾ÍÊÇËµµÍÎ»Ã»ÓĞÊı¾İÎª0Ê±£¬¸ßÎ»¾ÍÒªTemp_Value[ 1 ]È¡·´¼Ó1
  41   2                              Temp_Value[ 1 ]++;
  42   2                      ng = 1; //¸ººÅ±êÖ¾Î»
  43   2              }
  44   1      
  45   1              Display_Digit[ 0 ] =  df_Table[ Temp_Value[ 0 ] & 0x0f ]; //ÅĞ¶ÏµÍÎ»µÄ8¸ö×Ö½ÚµÍ4Î»9ÏÔÊ¾Ğ¡Êı²¿·Ö£©
  46   1      
  47   1              //»ñÈ¡ÎÂ¶ÈÕûÊı²¿·Ö£¨ÕûÊı²¿·Ö²»ÖªÊÇ¸º»¹ÊÇÕı£©
  48   1              Current = ((Temp_Value[ 0 ] & 0xF0 ) >> 4 )     | ((Temp_Value[ 1 ] & 0x07) << 4 );//Temp_Value[ 0 ] & 0xf0±í
             -Ê¾ÒªÈ¥µôĞ¡Êı²¿·Ö£¬ÔÙÓÒÒÆ4Î»¸²¸Ç×îµÍÎ»£¬·½±ã¸ß×Ö½Ú
  49   1                                                                                                                                                                         //µÄµÍ4Î»×óÒÆÀ´Ìî³ä×éºÏÎªÎÂ¶ÈÕûÊı²¿·Ö
  50   1      
  51   1              //ÅĞ¶Ïµ±Ç°ÕûÊı²¿·ÖÎÂ¶ÈÎÂ¶ÈÖµÕı¸º
C51 COMPILER V9.00   DS18B20DISTEMP                                                        05/31/2013 22:02:19 PAGE 2   

  52   1              Signed_Current_Temp = ng?  -Current : Current;  //Èç¹ûµ±Ç°ÎÂ¶ÈÎª¸º£¬ÔÚÇ°Ãæ¼ÓÒ»¸ö¸ººÅ
  53   1              //ÅĞ¶Ï±¨¾¯ÎÂ¶È
  54   1              H_Alarm = Signed_Current_Temp >= Alarm_Temp[ 0 ] ? 1 : 0;  //³¬¹ıÎÂ¶ÈÉÏÏŞ£¬LED»áÉÁË¸
  55   1          L_Alarm = Signed_Current_Temp <= Alarm_Temp[ 1 ] ? 1 : 0;  //µÍÓÚÎÂ¶ÈÏÂÏŞ£¬LEDÒ²»áÉÁË¸
  56   1              //½«¶ÁÈ¡µÄÕûÊıÎÂ¶È·Ö½â
  57   1      
  58   1              Display_Digit[ 3 ] =  Current / 100;
  59   1              Display_Digit[ 2 ] =  Current % 100 / 10;
  60   1              Display_Digit[ 1 ] =  Current % 10;
  61   1      
  62   1              Current_Temp_DIS_BUFFER[ 10 ] =  Display_Digit[ 0 ] + '0';//LCD12864ÏÔÊ¾»º³å
  63   1              Current_Temp_DIS_BUFFER[ 9 ] =  '.';
  64   1              Current_Temp_DIS_BUFFER[ 8 ] =  Display_Digit[ 1 ] + '0';
  65   1              Current_Temp_DIS_BUFFER[ 7 ] =  Display_Digit[ 2 ] + '0';
  66   1              Current_Temp_DIS_BUFFER[ 6 ] =  Display_Digit[ 3 ] + '0';
  67   1      
  68   1              if( Display_Digit[ 3 ] == 0 )
  69   1                      Current_Temp_DIS_BUFFER[ 6 ] = ' ';
  70   1              if( Display_Digit[ 3 ] == 0 && Display_Digit[ 2 ] == 0  )
  71   1                      Current_Temp_DIS_BUFFER[ 7 ] = ' ';
  72   1              //ÅĞ¶Ï¸ºÖµ
  73   1              if( ng )
  74   1              {
  75   2                      if( Current_Temp_DIS_BUFFER[ 7 ] ==' ')
  76   2                              Current_Temp_DIS_BUFFER[ 7 ] = '-';
  77   2      
  78   2                      else if( Current_Temp_DIS_BUFFER[ 6 ] == ' ')
  79   2                              Current_Temp_DIS_BUFFER[ 6 ] = '-';
  80   2                      else
  81   2                              Current_Temp_DIS_BUFFER[ 5 ] = '-';
  82   2              }
  83   1      
  84   1          LCD_PutString( 0, 3, Current_Temp_DIS_BUFFER );     
  85   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    246    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =     22    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
