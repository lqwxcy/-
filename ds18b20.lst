C51 COMPILER V9.00   DS18B20                                                               05/31/2013 22:02:19 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN .\output\ds18b20.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE src\ds18b20.c BROWSE DEBUG OBJECTEXTEND PRINT(.\output\ds18b20.lst) OBJECT(
                    -.\output\ds18b20.obj)

line level    source

   1          /*********************************************************** 
   2          ÎÄ¼þÃû³Æ£º DS18b20º¯Êý
   3          ×÷ Õß£º    ÁºÈ¨Íþ
   4          °æ ±¾£º    0.01
   5          Ëµ Ã÷£º    
   6          Ê±¼ä £º    2012Äê12ÔÂ19ÈÕ20:50:58
   7          ÐÞ¸Ä¼ÇÂ¼£º
   8          ×Ü½á £º         
   9          ***********************************************************/
  10          #include"delay.h"
  11          #include"ds18b20.h"
  12          #include"ds18b20alarm.h"
  13          /*------------------------------------------
  14                  ds18b20¿ØÖÆ¹Ü½Å¶¨Òå
  15          -------------------------------------------*/
  16          sbit DQ = P2^3;
  17          
  18          /*------------------------------------------
  19                  ¶¨Òå²Ù×÷±äÁ¿
  20          -------------------------------------------*/
  21          u8 Temp_Value[] = { 0x00,0x00 }; //¶¨ÒåÒ»¸öÊý¾ÝÀ´´æ´¢Ëù¶ÁÈ¡µÄÎÂ¶ÈÖµ
  22          bit iS_DS18B20_OK = 1;
  23          /*********************************************************** 
  24          º¯ÊýÃû³Æ£º       u8 Init_DS18B20())
  25          º¯Êý¹¦ÄÜ£º       ds18b20³õÊ¼»¯             
  26          Èë¿Ú²ÎÊý£º       
  27          ³ö¿Ú²ÎÊý£º       stateÖµÎª0¶ÁÈ¡Æ÷¼þ³É¹¦£¬·ñÔòÊ§°Ü
  28          ±¸ ×¢£º 
  29          ***********************************************************/
  30          u8 Init_DS18B20()
  31          {
  32   1              u8 state; //¶¨Òå¶Áµ½Æ÷¼þ·¢µ½ÐÅºÅDQ = 0ËµÃ÷ÓÐÆ÷¼þ´æÔÚ£¬ÐÅºÅ = 1ËµÃ÷¶ÁÆ÷¼þÊ§°Ü
  33   1              DQ = 1;
  34   1              DelayUs( 8 );//ÉÔ×÷ÑÓ³Ù
  35   1              DQ = 0;
  36   1              DelayUs( 80 );//ÑÓ³ÙÊ±¼äÒªÇóÎª480us-960us
  37   1              DQ = 1; //ÊÍ·ÅÊý¾ÝÏß
  38   1              DelayUs( 8 );//ÒªÇóÑÓ³ÙÊ±¼äÎª15us-60us
  39   1              state = DQ;//¶ÁÈ¡DQµÄÖµ£¬Îª1Ã»ÓÐÆ÷¼þ´æÔÚ£¬0¾ÍÓÐÆ÷¼þ´æÔÚ
  40   1              DelayUs( 4 );//ÉÔ×÷ÑÓ³Ù
  41   1              DQ = 1;   //×îºóÊÍ·Å×ÜÏß
  42   1              return state; 
  43   1      }
  44          
  45          /*********************************************************** 
  46          º¯ÊýÃû³Æ£º       void ds18b20_Write_A_Byte( u8 dat )
  47          º¯Êý¹¦ÄÜ£º       ÏòDS18B20Ð´Ò»¸ö×Ö½ÚÊý¾Ý                   
  48          Èë¿Ú²ÎÊý£º       datÊÇ×Ô¼ºÏëÐ´Èëds18b20ÀïÃæµÄÊý¾Ý
  49          ³ö¿Ú²ÎÊý£º       
  50          ±¸ ×¢£º 
  51          ***********************************************************/
  52          void ds18b20_Write_A_Byte( u8 dat )
  53          {
  54   1              u8 i;
C51 COMPILER V9.00   DS18B20                                                               05/31/2013 22:02:19 PAGE 2   

  55   1              for( i = 0; i < 8; i++ )
  56   1              {
  57   2                      DQ = 0;
  58   2                      DQ = dat & 0x01;//Êý¾Ý°´µÍÎ»µ½¸ßÎ»·¢ËÍ
  59   2                      DelayUs( 10);
  60   2                      DQ = 1;
  61   2                      dat  = dat >> 1;
  62   2              }
  63   1              DelayUs( 4 );//ÉÔ×÷ÑÓ³Ù 
  64   1      }
  65          
  66          /*********************************************************** 
  67          º¯ÊýÃû³Æ£º       u8 ds18b20_Read_A_Byte()
  68          º¯Êý¹¦ÄÜ£º       ´ÓDS18B20¶ÁÈ¡Ò»¸ö×Ö½ÚÊý¾Ý                 
  69          Èë¿Ú²ÎÊý£º       
  70          ³ö¿Ú²ÎÊý£º       datÊÇ´Óds18b20ÀïÃæ¶Áµ½µÄÊý¾Ý
  71          ±¸ ×¢£º 
  72          ***********************************************************/
  73          u8 ds18b20_Read_A_Byte()
  74          {
  75   1              u8 dat;
  76   1              u8 i;
  77   1              for( i = 0; i < 8; i++ )
  78   1              {
  79   2                      DQ = 0;
  80   2                      dat = dat >> 1; //ÏÈ°ÑÊý¾ÝÓÒÒÆ³öÀ´ÔÙ¶ÁÈ¡
  81   2                      DQ = 1;
  82   2                      if( DQ )
  83   2                              dat = dat | 0x80;
  84   2                      DelayUs( 10 );
  85   2                      DQ = 1; //ÊÍ·Å×ÜÏß¶ÁÈ¡ÏÂÒ»¸öÊý¾Ý
  86   2              }
  87   1              return dat;
  88   1      }
  89          
  90          /*********************************************************** 
  91          º¯ÊýÃû³Æ£º       void ds18b20_ReadTemperature()
  92          º¯Êý¹¦ÄÜ£º       ¶ÁÈ¡ÎÂ¶ÈÖµ·Ö±ð·ÅÔÚTemp_Value[]£¨´æ·ÅÎÂ¶ÈÖµ£©ÓëTemp_Alarm[]£¨´æ·Å±¨¾¯Öµ
  93          £©Á½¸öÊý×é                 
  94          Èë¿Ú²ÎÊý£º       
  95          ³ö¿Ú²ÎÊý£º       datÊÇ´Óds18b20ÀïÃæ¶Áµ½µÄÊý¾Ý
  96          ±¸ ×¢£º 
  97          ***********************************************************/
  98          void ds18b20_ReadTemperature()
  99          {
 100   1              if( Init_DS18B20() == 1 ) //Init_DS18B20()ÅÐ¶Ïº¯Êý·µ»ØÖµÊÇ·ñÎª0£¬Îª1Ôò¶ÁÈ¡Ê§°Ü£ºiS_DS18B20_OK = 0;£¬
 101   1              {
 102   2                      iS_DS18B20_OK = 0;
 103   2              }
 104   1              else
 105   1              {
 106   2                      ds18b20_Write_A_Byte( 0xCC );//Ìø¹ýROM
 107   2                      ds18b20_Write_A_Byte( 0x44 );//Æô¶¯ÎÂ¶È×ª»»     
 108   2                      //DelayUs( 200 );
 109   2                              
 110   2                      Init_DS18B20();//ds1820³õÊ¼»¯
 111   2                      ds18b20_Write_A_Byte( 0xCC );//Ìø¹ýROM
 112   2                      ds18b20_Write_A_Byte( 0xBE );//µ¥Æ¬»ú¶ÁDS18B20ÄÚ²¿RAMÖÐ 9¸ö×Ö½ÚµÄÎÂ¶ÈÊý¾Ý£¨¾ÍÊÇ°Ñds18b20RAMÖÐÊý¾Ý·¢ËÍµ½µ
             -¥Æ¬»ú£©
 113   2                      
 114   2                      Temp_Value[ 0 ] = ds18b20_Read_A_Byte();//ÏÈ¶ÁÈ¡µÍÎ»
 115   2                      Temp_Value[ 1 ] = ds18b20_Read_A_Byte();//ÔÙ¶ÁÈ¡¸ßÎ»    
C51 COMPILER V9.00   DS18B20                                                               05/31/2013 22:02:19 PAGE 3   

 116   2                      
 117   2                      Alarm_Temp[ 0 ] = ds18b20_Read_A_Byte();//ÉèÖÃÎÂ¶È±¨¾¯ÖµÉÏÏÞ
 118   2                      Alarm_Temp[ 1 ] = ds18b20_Read_A_Byte();//ÉèÖÃÎÂ¶È±¨¾¯ÖµÏÂÏÞ
 119   2                      iS_DS18B20_OK  = 1;     
 120   2              }       
 121   1      }
 122          
 123          /*********************************************************** 
 124          º¯ÊýÃû³Æ£º       void Set_DS18B20_Alarm_Temp()
 125          º¯Êý¹¦ÄÜ£º       ÉèÖÃDS18B20ÎÂ¶ÈµÄ±¨¾¯Öµ£¬ÇÒÐ´Èëds18b20Àï
 126          £©Á½¸öÊý×é                 
 127          Èë¿Ú²ÎÊý£º       
 128          ³ö¿Ú²ÎÊý£º       
 129          ±¸ ×¢£º 
 130          ***********************************************************/
 131          void Set_DS18B20_Alarm_Temp()
 132          {
 133   1              Init_DS18B20();
 134   1              ds18b20_Write_A_Byte( 0xCC );//Ìø¹ýROM  
 135   1              ds18b20_Write_A_Byte( 0x4E );//Ð´ÔÝ´æÆ÷£¬°Ñ±¨¾¯ÎÂ¶ÈµÄÖµÐ´½ø2£¬3¸ö×Ö½ÚÀïÃæ
 136   1              ds18b20_Write_A_Byte(  Alarm_Temp[ 0 ] );//Ð´ÎÂ¶ÈµÄÉÏÏÞ 
 137   1              ds18b20_Write_A_Byte(  Alarm_Temp[ 1 ] );//Ð´ÎÂ¶ÈµÄÏÂÏÞ
 138   1              ds18b20_Write_A_Byte( 0x7f );//12Î»¾«¶È
 139   1      
 140   1              Init_DS18B20();
 141   1              ds18b20_Write_A_Byte( 0xCC );//Ìø¹ýROM  
 142   1              ds18b20_Write_A_Byte( 0x48 );//½«ÎÂ¶È±¨¾¯Æ÷µÄÖµ´æÈëDS18B20      
 143   1      }
 144          
 145          
 146          
 147          
 148          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    232    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
